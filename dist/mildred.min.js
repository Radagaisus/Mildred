var support;window.Mildred={},support={propertyDescriptors:function(){var o;if("function"!=typeof Object.defineProperty||"function"!=typeof Object.defineProperties)return!1;try{return o={},Object.defineProperty(o,"foo",{value:"bar"}),"bar"===o.foo}catch(error){return!1}}()};var utils,__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty;utils={beget:function(){var ctor;return"function"==typeof Object.create?Object.create:(ctor=function(){},function(obj){return ctor.prototype=obj,new ctor})}(),serialize:function(data){if("function"==typeof data.serialize)return data.serialize();if("function"==typeof data.toJSON)return data.toJSON();throw new TypeError("utils.serialize: Unknown data was passed")},readonly:function(){var readonlyDescriptor;return support.propertyDescriptors?(readonlyDescriptor={writable:!1,enumerable:!0,configurable:!1},function(){var obj,prop,properties,_i,_len;for(obj=arguments[0],properties=2<=arguments.length?__slice.call(arguments,1):[],_i=0,_len=properties.length;_len>_i;_i++)prop=properties[_i],readonlyDescriptor.value=obj[prop],Object.defineProperty(obj,prop,readonlyDescriptor);return!0}):function(){return!1}}(),getPrototypeChain:function(object){var chain,_ref,_ref1,_ref2;for(chain=[object.constructor.prototype];object=null!=(_ref=null!=(_ref1=object.constructor)?_ref1.__super__:void 0)?_ref:null!=(_ref2=object.constructor)?_ref2.superclass:void 0;)chain.push(object);return chain.reverse()},getAllPropertyVersions:function(object,property){var proto,result,value,_i,_len,_ref;for(result=[],_ref=utils.getPrototypeChain(object),_i=0,_len=_ref.length;_len>_i;_i++)proto=_ref[_i],value=proto[property],value&&__indexOf.call(result,value)<0&&result.push(value);return result},upcase:function(str){return str.charAt(0).toUpperCase()+str.substring(1)},escapeRegExp:function(str){return String(str||"").replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},modifierKeyPressed:function(event){return event.shiftKey||event.altKey||event.ctrlKey||event.metaKey},queryParams:{stringify:function(queryParams){var arrParam,encodedKey,key,query,value,_i,_len;query="";for(key in queryParams)if(__hasProp.call(queryParams,key))if(value=queryParams[key],encodedKey=encodeURIComponent(key),_.isArray(value))for(_i=0,_len=value.length;_len>_i;_i++)arrParam=value[_i],query+="&"+encodedKey+"="+encodeURIComponent(arrParam);else query+="&"+encodedKey+"="+encodeURIComponent(value);return query&&query.substring(1)},parse:function(queryString){var current,field,pair,pairs,params,value,_i,_len,_ref;if(params={},!queryString)return params;for(pairs=queryString.split("&"),_i=0,_len=pairs.length;_len>_i;_i++)pair=pairs[_i],pair.length&&(_ref=pair.split("="),field=_ref[0],value=_ref[1],field.length&&(field=decodeURIComponent(field),value=decodeURIComponent(value),current=params[field],current?current.push?current.push(value):params[field]=[current,value]:params[field]=value));return params}},serializeAttributes:function(model,attributes,modelStack){var delegator,key,otherModel,serializedModels,value,_i,_len,_ref;delegator=this.beget(attributes),null==modelStack&&(modelStack={}),modelStack[model.cid]=!0;for(key in attributes)if(value=attributes[key],value instanceof Backbone.Model)delegator[key]=utils.serializeModelAttributes(value,model,modelStack);else if(value instanceof Backbone.Collection){for(serializedModels=[],_ref=value.models,_i=0,_len=_ref.length;_len>_i;_i++)otherModel=_ref[_i],serializedModels.push(utils.serializeModelAttributes(otherModel,model,modelStack));delegator[key]=serializedModels}return delete modelStack[model.cid],delegator},serializeModelAttributes:function(model,currentModel,modelStack){var attributes;return model===currentModel||_.has(modelStack,model.cid)?null:(attributes="function"==typeof model.getAttributes?model.getAttributes():model.attributes,this.serializeAttributes(model,attributes,modelStack))}},"function"==typeof Object.seal&&Object.seal(utils);var __hasProp={}.hasOwnProperty;Mildred.Composition=function(){function Composition(options){null!=options&&(this.options=_.clone(options)),this.item=this,this.initialize(this.options)}return Composition.extend=Backbone.Model.extend,_.extend(Composition.prototype,Backbone.Events),Composition.prototype.item=null,Composition.prototype.options=null,Composition.prototype._stale=!1,Composition.prototype.initialize=function(){},Composition.prototype.compose=function(){},Composition.prototype.check=function(options){return _.isEqual(this.options,options)},Composition.prototype.stale=function(value){var item,name;if(null==value)return this._stale;this._stale=value;for(name in this)item=this[name],item&&item!==this&&_.has(item,"stale")&&(item.stale=value)},Composition.prototype.disposed=!1,Composition.prototype.dispose=function(){var obj,prop,properties,_i,_len;if(!this.disposed){for(prop in this)__hasProp.call(this,prop)&&(obj=this[prop],obj&&"function"==typeof obj.dispose&&obj!==this&&(obj.dispose(),delete this[prop]));for(this.stopListening(),this.off,properties=["redirected"],_i=0,_len=properties.length;_len>_i;_i++)prop=properties[_i],delete this[prop];return this.disposed=!0}},Composition}(),Mildred.Composer=function(){function Composer(){this.initialize.apply(this,arguments)}return Composer.extend=Backbone.Model.extend,Composer.prototype.compositions=null,Composer.prototype.initialize=function(options){return null==options&&(options={}),this.compositions={},Backbone.on("composer:compose",this.compose,this),Backbone.on("composer:retrieve",this.retrieve,this),Backbone.on("dispatcher:dispatch",this.cleanup)},Composer.prototype.compose=function(name,second,third){return"function"==typeof second?third||second.prototype.dispose?second.prototype instanceof Mildred.Composition?this._compose(name,{composition:second,options:third}):this._compose(name,{options:third,compose:function(){var autoRender,disabledAutoRender;return this.item=new second(this.options),autoRender=this.item.autoRender,disabledAutoRender=void 0===autoRender||!autoRender,disabledAutoRender&&"function"==typeof this.item.render?this.item.render():void 0}}):this._compose(name,{compose:second}):"function"==typeof third?this._compose(name,{compose:third,options:second}):this._compose(name,second)},Composer.prototype._compose=function(name,options){var composition,current,isPromise,returned;if("function"!=typeof options.compose&&null==options.composition)throw new Error("Composer#compose was used incorrectly");return null!=options.composition?composition=new options.composition(options.options):(composition=new Mildred.Composition(options.options),composition.compose=options.compose,options.check&&(composition.check=options.check)),current=this.compositions[name],isPromise=!1,current&&current.check(composition.options)?current.stale(!1):(current&&current.dispose(),returned=composition.compose(composition.options),isPromise="function"==typeof(null!=returned?returned.then:void 0),composition.stale(!1),this.compositions[name]=composition),isPromise?returned:this.compositions[name].item},Composer.prototype.retrieve=function(name){var active;return active=this.compositions[name],active&&!active.stale()?active.item:void 0},Composer.prototype.cleanup=function(){var composition,name,_ref;_ref=this.compositions;for(name in _ref)composition=_ref[name],composition.stale()?(composition.dispose(),delete this.compositions[name]):composition.stale(!0)},Composer.prototype.dispose=function(){var composition,name,_ref;if(!this.disposed){this.off,_ref=this.compositions;for(name in _ref)composition=_ref[name],composition.dispose();return delete this.compositions,this.disposed=!0}},Composer}(),Mildred.Dispatcher=function(){function Dispatcher(){this.initialize.apply(this,arguments)}return Dispatcher.extend=Backbone.Model.extend,Dispatcher.prototype.previousRoute=null,Dispatcher.prototype.currentController=null,Dispatcher.prototype.currentRoute=null,Dispatcher.prototype.currentParams=null,Dispatcher.prototype.initialize=function(options){return null==options&&(options={}),this.controllers=options.controllers,Backbone.on("router:match",this.dispatch,this)},Dispatcher.prototype.dispatch=function(route,params,options){var controller,_ref,_ref1;return params=params?_.clone(params):{},options=options?_.clone(options):{},options.changeURL!==!1&&(options.changeURL=!0),options.forceStartup!==!0&&(options.forceStartup=!1),options.forceStartup||(null!=(_ref=this.currentRoute)?_ref.controller:void 0)!==route.controller||(null!=(_ref1=this.currentRoute)?_ref1.action:void 0)!==route.action||!_.isEqual(this.currentParams,params)?(controller=this.getControllerByName(route.controller),this.runController(controller,route,params,options)):void 0},Dispatcher.prototype.getControllerByName=function(name){var controller;return controller="",this.controllers.forEach(function(el){return el.name.toUpperCase()===name.toUpperCase()?controller=el:void 0}),controller},Dispatcher.prototype.runController=function(controller,route,params,options){return this.previousRoute=this.currentRoute,this.currentRoute=_.extend({},route,{previous:utils.beget(this.previousRoute)}),controller=new controller(params,this.currentRoute,options),this.executeBeforeAction(controller,this.currentRoute,params,options)},Dispatcher.prototype.executeAction=function(controller,route,params,options){return this.currentController&&(Backbone.trigger("beforeControllerDispose",this.currentController),this.currentController.dispose(params,route,options)),this.currentController=controller,this.currentParams=params,controller[route.action](params,route,options),controller.redirected?void 0:(this.adjustURL(route,params,options),Backbone.trigger("dispatcher:dispatch",this.currentController,params,route,options))},Dispatcher.prototype.executeBeforeAction=function(controller,route,params,options){var before,executeAction,promise,_this=this;if(before=controller.beforeAction,executeAction=function(){return controller.redirected||_this.currentRoute&&route!==_this.currentRoute?(controller.dispose(),void 0):_this.executeAction(controller,route,params,options)},!before)return executeAction(),void 0;if("function"!=typeof before)throw new TypeError("Controller#beforeAction: function expected. Old object-like form is not supported.");return promise=controller.beforeAction(params,route,options),promise&&promise.then?promise.then(executeAction):executeAction()},Dispatcher.prototype.adjustURL=function(route,params,options){var url;if(null!=route.path)return url=route.path+(route.query?"?"+route.query:""),options.changeURL?Backbone.trigger("router:changeURL",url,options):void 0},Dispatcher.prototype.disposed=!1,Dispatcher.prototype.dispose=function(){return this.disposed?void 0:(this.off,this.disposed=!0)},Dispatcher}();var STATE_CHANGE,SYNCED,SYNCING,UNSYNCED,event,_fn,_i,_len,_ref;for(UNSYNCED="unsynced",SYNCING="syncing",SYNCED="synced",STATE_CHANGE="syncStateChange",Mildred.SyncMachine={_syncState:UNSYNCED,_previousSyncState:null,syncState:function(){return this._syncState},isUnsynced:function(){return this._syncState===UNSYNCED},isSynced:function(){return this._syncState===SYNCED},isSyncing:function(){return this._syncState===SYNCING},unsync:function(){var _ref;((_ref=this._syncState)===SYNCING||_ref===SYNCED)&&(this._previousSync=this._syncState,this._syncState=UNSYNCED,this.trigger(this._syncState,this,this._syncState),this.trigger(STATE_CHANGE,this,this._syncState))},beginSync:function(){var _ref;((_ref=this._syncState)===UNSYNCED||_ref===SYNCED)&&(this._previousSync=this._syncState,this._syncState=SYNCING,this.trigger(this._syncState,this,this._syncState),this.trigger(STATE_CHANGE,this,this._syncState))},finishSync:function(){this._syncState===SYNCING&&(this._previousSync=this._syncState,this._syncState=SYNCED,this.trigger(this._syncState,this,this._syncState),this.trigger(STATE_CHANGE,this,this._syncState))},abortSync:function(){this._syncState===SYNCING&&(this._syncState=this._previousSync,this._previousSync=this._syncState,this.trigger(this._syncState,this,this._syncState),this.trigger(STATE_CHANGE,this,this._syncState))}},_ref=[UNSYNCED,SYNCING,SYNCED,STATE_CHANGE],_fn=function(event){return Mildred.SyncMachine[event]=function(callback,context){return null==context&&(context=this),this.on(event,callback,context),this._syncState===event?callback.call(context):void 0}},_i=0,_len=_ref.length;_len>_i;_i++)event=_ref[_i],_fn(event);var helpers;helpers={reverse:function(criteria,params,query){return Backbone.trigger("router:reverse",criteria,params,query)},redirectTo:function(pathDesc,params,options){return Backbone.trigger("router:route",pathDesc,params,options)}};var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Mildred.History=function(_super){function History(){return History.__super__.constructor.apply(this,arguments)}return __extends(History,_super),History.prototype.routeStripper=/^[#\/]|\s+$/g,History.prototype.rootStripper=/^\/+|\/+$/g,History.prototype.isExplorer=/msie [\w.]+/,History.prototype.trailingSlash=/\/$/,History.prototype.getFragment=function(fragment,forcePushState){var root;return null==fragment&&(this._hasPushState||!this._wantsHashChange||forcePushState?(fragment=this.location.pathname+this.location.search,root=this.root.replace(this.trailingSlash,""),fragment.indexOf(root)||(fragment=fragment.substr(root.length))):fragment=this.getHash()),fragment.replace(this.routeStripper,"")},History.prototype.start=function(options){var atRoot,docMode,fragment,loc,oldIE;if(Backbone.History.started)throw new Error("Backbone.history has already been started");return Backbone.History.started=!0,this.options=_.extend({},{root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState),fragment=this.getFragment(),docMode=document.documentMode,oldIE=this.isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||7>=docMode),this.root=("/"+this.root+"/").replace(this.rootStripper,"/"),oldIE&&this._wantsHashChange&&(this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(fragment)),this._hasPushState?Backbone.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&__indexOf.call(window,"onhashchange")>=0&&!oldIE?Backbone.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=fragment,loc=this.location,atRoot=loc.pathname.replace(/[^\/]$/,"$&/")===this.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash&&(this.fragment=this.getHash().replace(this.routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},History}(Backbone.History);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty;Mildred.Route=function(){function Route(pattern,controller,action,options){var _ref;if(this.pattern=pattern,this.controller=controller,this.action=action,this.handler=__bind(this.handler,this),this.addParamName=__bind(this.addParamName,this),_.isRegExp(this.pattern))throw new Error("Route: RegExps are not supported.      Use strings with :names and `constraints` option of route");if(this.options=options?_.clone(options):{},null!=this.options.name&&(this.name=this.options.name),this.name&&-1!==this.name.indexOf("#"))throw new Error('Route: "#" cannot be used in name');if(null==(_ref=this.name)&&(this.name=this.controller+"#"+this.action),this.paramNames=[],_.has(Mildred.Controller.prototype,this.action))throw new Error("Route: You should not use existing controller properties as action names");this.createRegExp(),"function"==typeof Object.freeze&&Object.freeze(this)}var escapeRegExp;return Route.extend=Backbone.Model.extend,escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g,Route.prototype.matches=function(criteria){var invalidParamsCount,name,propertiesCount,property,_i,_len,_ref;if("string"==typeof criteria)return criteria===this.name;for(propertiesCount=0,_ref=["name","action","controller"],_i=0,_len=_ref.length;_len>_i;_i++)if(name=_ref[_i],propertiesCount++,property=criteria[name],property&&property!==this[name])return!1;return invalidParamsCount=1===propertiesCount&&("action"===name||"controller"===name),!invalidParamsCount},Route.prototype.reverse=function(params,query){var name,url,value,_i,_len,_ref;if(params=this.normalizeParams(params),params===!1)return!1;for(url=this.pattern,_ref=this.paramNames,_i=0,_len=_ref.length;_len>_i;_i++)name=_ref[_i],value=params[name],url=url.replace(RegExp("[:*]"+name,"g"),value);return query?url+="object"==typeof query?"?"+utils.queryParams.stringify(query):("?"===query[0]?"":"?")+query:url},Route.prototype.normalizeParams=function(params){var paramIndex,paramName,paramsHash,_i,_len,_ref;if(_.isArray(params)){if(params.length<this.paramNames.length)return!1;for(paramsHash={},_ref=this.paramNames,paramIndex=_i=0,_len=_ref.length;_len>_i;paramIndex=++_i)paramName=_ref[paramIndex],paramsHash[paramName]=params[paramIndex];if(!this.testConstraints(paramsHash))return!1;params=paramsHash}else if(null==params&&(params={}),!this.testParams(params))return!1;return params},Route.prototype.testConstraints=function(params){var constraint,constraints,name;if(constraints=this.options.constraints)for(name in constraints)if(__hasProp.call(constraints,name)&&(constraint=constraints[name],!constraint.test(params[name])))return!1;return!0},Route.prototype.testParams=function(params){var paramName,_i,_len,_ref;for(_ref=this.paramNames,_i=0,_len=_ref.length;_len>_i;_i++)if(paramName=_ref[_i],void 0===params[paramName])return!1;return this.testConstraints(params)},Route.prototype.createRegExp=function(){var pattern;return pattern=this.pattern.replace(escapeRegExp,"\\$&").replace(/(?::|\*)(\w+)/g,this.addParamName),this.regExp=RegExp("^"+pattern+"(?=\\?|$)")},Route.prototype.addParamName=function(match,paramName){return this.paramNames.push(paramName),":"===match.charAt(0)?"([^/?]+)":"(.*?)"},Route.prototype.test=function(path){var constraints,matched;return(matched=this.regExp.test(path))?(constraints=this.options.constraints,constraints?this.testConstraints(this.extractParams(path)):!0):!1},Route.prototype.handler=function(pathParams,options){var actionParams,params,path,query,route,_ref;return options=options?_.clone(options):{},"object"==typeof pathParams?(query=utils.queryParams.stringify(options.query),params=pathParams,path=this.reverse(params)):(_ref=pathParams.split("?"),path=_ref[0],query=_ref[1],null==query?query="":options.query=utils.queryParams.parse(query),params=this.extractParams(path)),actionParams=_.extend({},params,this.options.params),route={path:path,action:this.action,controller:this.controller,name:this.name,query:query},Backbone.Events.trigger("router:match",route,actionParams,options)},Route.prototype.extractParams=function(path){var index,match,matches,paramName,params,_i,_len,_ref;for(params={},matches=this.regExp.exec(path),_ref=matches.slice(1),index=_i=0,_len=_ref.length;_len>_i;index=++_i)match=_ref[index],paramName=this.paramNames.length?this.paramNames[index]:index,params[paramName]=match;return params},Route}();var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Mildred.Router=function(){function Router(options){var isWebFile;this.options=null!=options?options:{},this.match=__bind(this.match,this),isWebFile="file:"!==window.location.protocol,_.defaults(this.options,{pushState:isWebFile,root:"/"}),this.removeRoot=new RegExp("^"+utils.escapeRegExp(this.options.root)+"(#)?"),Backbone.on("router:route",this.route,this),Backbone.on("router:reverse",this.reverse,this),Backbone.on("router:changeURL",this.changeURL,this),this.createHistory()}return Router.extend=Backbone.Model.extend,Router.prototype.createHistory=function(){return Backbone.history=new Mildred.History},Router.prototype.startHistory=function(){return Backbone.history.start(this.options)},Router.prototype.match=function(pattern,target,options){var action,controller,route,_ref;if(null==options&&(options={}),2===arguments.length&&"object"==typeof target){if(options=target,controller=options.controller,action=options.action,!controller||!action)throw new Error("Router#match must receive either target or options.controller & options.action")}else{if(controller=options.controller,action=options.action,controller||action)throw new Error("Router#match cannot use both target and options.controller / options.action");_ref=target.split("#"),controller=_ref[0],action=_ref[1]}return route=new Mildred.Route(pattern,controller,action,options),Backbone.history.handlers.push({route:route,callback:route.handler}),route},Router.prototype.route=function(pathDesc,params,options){var handler,path;if(params=params?_.clone(params):{},"object"==typeof pathDesc&&(path=pathDesc.url),null!=path?(path=path.replace(this.removeRoot,""),handler=_.find(Backbone.history.handlers,function(handler){return handler.route.test(path)}),options=params,params=null):(options=options?_.clone(options):{},handler=_.find(Backbone.history.handlers,function(handler){return handler.route.matches(pathDesc)&&(params=handler.route.normalizeParams(params))?!0:!1})),handler)return _.defaults(options,{changeURL:!0}),handler.callback(path||params,options),!0;throw new Error("Router#route: request was not routed")},Router.prototype.reverse=function(criteria,params,query){var handler,handlers,reversed,root,url,_i,_len;if(root=this.options.root,null!=params&&"object"!=typeof params)throw new TypeError("Router#reverse: params must be an array or an object");for(handlers=Backbone.history.handlers,_i=0,_len=handlers.length;_len>_i;_i++)if(handler=handlers[_i],handler.route.matches(criteria)&&(reversed=handler.route.reverse(params,query),reversed!==!1))return url=root?root+reversed:reversed;throw new Error("Router#reverse: invalid route specified")},Router.prototype.changeURL=function(url,options){var navigateOptions;return null==options&&(options={}),navigateOptions={trigger:options.trigger===!0,replace:options.replace===!0},Backbone.history.navigate(url,navigateOptions)},Router.prototype.disposed=!1,Router.prototype.dispose=function(){return this.disposed?void 0:(Backbone.history.stop(),delete Backbone.history,Backbone.off("router:route"),Backbone.off("router:reverse"),Backbone.off("router:changeURL"),this.disposed=!0)},Router}();var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Mildred.Model=function(_super){function Model(){return Model.__super__.constructor.apply(this,arguments)}return __extends(Model,_super),Model.prototype.getAttributes=function(){return this.attributes},Model.prototype.serialize=function(){return utils.serializeAttributes(this,this.getAttributes())},Model.prototype.disposed=!1,Model.prototype.dispose=function(){var prop,properties,_i,_len;if(!this.disposed){for(this.trigger("dispose",this),this.stopListening(),this.off(),properties=["collection","attributes","changed","_escapedAttributes","_previousAttributes","_silent","_pending","_callbacks"],_i=0,_len=properties.length;_len>_i;_i++)prop=properties[_i],delete this[prop];return this.disposed=!0}},Model}(Backbone.Model);var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Mildred.Collection=function(_super){function Collection(){return Collection.__super__.constructor.apply(this,arguments)}return __extends(Collection,_super),Collection.prototype.model=Mildred.Model,Collection.prototype.serialize=function(){return this.map(utils.serialize)},Collection.prototype.disposed=!1,Collection.prototype.dispose=function(){var prop,properties,_i,_len;if(!this.disposed){for(this.trigger("dispose",this),this.reset([],{silent:!0}),this.stopListening(),this.off(),properties=["model","models","_byId","_byCid","_callbacks"],_i=0,_len=properties.length;_len>_i;_i++)prop=properties[_i],delete this[prop];return this.disposed=!0}},Collection}(Backbone.Collection);var __slice=[].slice,__hasProp={}.hasOwnProperty;Mildred.Controller=function(){function Controller(){this.initialize.apply(this,arguments)}return Controller.extend=Backbone.Model.extend,_.extend(Controller.prototype,Backbone.Events),Controller.prototype.view=null,Controller.prototype.redirected=!1,Controller.prototype.initialize=function(){},Controller.prototype.beforeAction=function(){},Controller.prototype.adjustTitle=function(subtitle){return Backbone.trigger("adjustTitle",subtitle)},Controller.prototype.compose=function(){var method;return method=1===arguments.length?"retrieve":"compose",Backbone.trigger.apply(Backbone,["composer:"+method].concat(__slice.call(arguments)))},Controller.prototype.redirectTo=function(pathDesc,params,options){return this.redirected=!0,helpers.redirectTo(pathDesc,params,options)},Controller.prototype.disposed=!1,Controller.prototype.dispose=function(){var obj,prop;if(!this.disposed){for(prop in this)__hasProp.call(this,prop)&&(obj=this[prop],obj&&"function"==typeof obj.dispose&&(obj.dispose(),delete this[prop]));return this.off(),this.stopListening(),this.disposed=!0}},Controller}();var $,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};$=Backbone.$,Mildred.View=function(_super){function View(options){var render,_this=this;options&&_.extend(this,_.pick(options,this.optionNames)),render=this.render,this.render=function(){return _this.disposed?!1:(render.apply(_this,arguments),_this.autoAttach&&_this.attach.apply(_this,arguments),_this)},this.subviews=[],this.subviewsByName={},View.__super__.constructor.apply(this,arguments),this.delegateListeners(),this.model&&this.listenTo(this.model,"dispose",this.dispose),this.collection&&this.listenTo(this.collection,"dispose",function(subject){return subject&&subject!==_this.collection?void 0:_this.dispose()}),this.autoRender&&this.render()}return __extends(View,_super),View.prototype.autoRender=!1,View.prototype.autoAttach=!0,View.prototype.container=null,View.prototype.containerMethod="append",View.prototype.stale=!1,View.prototype.keepElement=!1,View.prototype.subviews=null,View.prototype.subviewsByName=null,View.prototype.optionNames=["autoAttach","autoRender","container","containerMethod"],View.prototype.delegate=function(eventName,second,third){var bound,events,handler,list,selector,_this=this;if("string"!=typeof eventName)throw new TypeError("View#delegate: first argument must be a string");if(2===arguments.length)handler=second;else{if(3!==arguments.length)throw new TypeError("View#delegate: only two or three arguments are allowed");if(selector=second,"string"!=typeof selector)throw new TypeError("View#delegate: second argument must be a string");handler=third}if("function"!=typeof handler)throw new TypeError("View#delegate: handler argument must be function");return list=_.map(eventName.split(" "),function(event){return""+event+".delegate"+_this.cid}),events=list.join(" "),bound=_.bind(handler,this),this.$el.on(events,selector||null,bound),bound},View.prototype._delegateEvents=function(events){var bound,eventName,handler,key,match,selector,value;for(key in events){if(value=events[key],handler="function"==typeof value?value:this[value],!handler)throw new Error("Method '"+handler+"' does not exist");match=key.match(/^(\S+)\s*(.*)$/),eventName=""+match[1]+".delegateEvents"+this.cid,selector=match[2],bound=_.bind(handler,this),this.$el.on(eventName,selector||null,bound)}},View.prototype.delegateEvents=function(events){var classEvents,_i,_len,_ref;if(this.undelegateEvents(),events)return this._delegateEvents(events),void 0;if(this.events)for(_ref=utils.getAllPropertyVersions(this,"events"),_i=0,_len=_ref.length;_len>_i;_i++){if(classEvents=_ref[_i],"function"==typeof classEvents)throw new TypeError("View#delegateEvents: functions are not supported");this._delegateEvents(classEvents)}},View.prototype.undelegate=function(eventName,second,third){var events,handler,list,selector,_this=this;if(eventName){if("string"!=typeof eventName)throw new TypeError("View#undelegate: first argument must be a string");if(2===arguments.length)"string"==typeof second?selector=second:handler=second;else if(3===arguments.length){if(selector=second,"string"!=typeof selector)throw new TypeError("View#undelegate: second argument must be a string");handler=third}return list=_.map(eventName.split(" "),function(event){return""+event+".delegate"+_this.cid}),events=list.join(" "),this.$el.off(events,selector||null)}return this.$el.off(".delegate"+this.cid)},View.prototype.delegateListeners=function(){var eventName,key,method,target,version,_i,_len,_ref,_ref1;if(this.listen)for(_ref=utils.getAllPropertyVersions(this,"listen"),_i=0,_len=_ref.length;_len>_i;_i++){version=_ref[_i];for(key in version){if(method=version[key],"function"!=typeof method&&(method=this[method]),"function"!=typeof method)throw new Error("View#delegateListeners: "+(""+method+" must be function"));_ref1=key.split(" "),eventName=_ref1[0],target=_ref1[1],this.delegateListener(eventName,target,method)}}},View.prototype.delegateListener=function(eventName,target,callback){var prop;"model"===target||"collection"===target?(prop=this[target],prop&&this.listenTo(prop,eventName,callback)):target||this.on(eventName,callback,this)},View.prototype.subview=function(name,view){var byName,subviews;return subviews=this.subviews,byName=this.subviewsByName,name&&view?(this.removeSubview(name),subviews.push(view),byName[name]=view,view):name?byName[name]:void 0},View.prototype.removeSubview=function(nameOrView){var byName,index,name,otherName,otherView,subviews,view;if(nameOrView){if(subviews=this.subviews,byName=this.subviewsByName,"string"==typeof nameOrView)name=nameOrView,view=byName[name];else{view=nameOrView;for(otherName in byName)if(otherView=byName[otherName],view===otherView){name=otherName;break}}if(name&&view&&view.dispose)return view.dispose(),index=_.indexOf(subviews,view),-1!==index&&subviews.splice(index,1),delete byName[name]}},View.prototype.getTemplateData=function(){var data,source;return data=this.model?utils.serialize(this.model):this.collection?{items:utils.serialize(this.collection),length:this.collection.length}:{},source=this.model||this.collection,source&&("function"!=typeof source.isSynced||"synced"in data||(data.synced=source.isSynced())),data},View.prototype.getTemplateFunction=function(){return"function"==typeof Mildred.templateFunction?Mildred.templateFunction:_.template},View.prototype.render=function(){var html,templateFunc;return this.disposed?!1:(templateFunc=this.getTemplateFunction(this.template),"function"==typeof templateFunc&&(html=templateFunc(this.getTemplateData()),this.$el.html(html)),this)},View.prototype.attach=function(){return this.container&&!document.body.contains(this.el)?($(this.container)[this.containerMethod](this.el),this.trigger("addedToDOM")):void 0
},View.prototype.disposed=!1,View.prototype.dispose=function(){var prop,properties,subview,_i,_j,_len,_len1,_ref;if(!this.disposed){for(_ref=this.subviews,_i=0,_len=_ref.length;_len>_i;_i++)subview=_ref[_i],subview.dispose();for(this.off(),this.keepElement?(this.undelegateEvents(),this.undelegate(),this.stopListening()):this.remove(),properties=["el","$el","options","model","collection","subviews","subviewsByName","_callbacks"],_j=0,_len1=properties.length;_len1>_j;_j++)prop=properties[_j],delete this[prop];return this.disposed=!0}},View}(Backbone.View);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Mildred.Layout=function(_super){function Layout(options){null==options&&(options={}),this.openLink=__bind(this.openLink,this),this.title=options.title,this.settings=_.defaults(options,{titleTemplate:_.template("<% if (subtitle) { %><%= subtitle %> â€“ <% } %><%= title %>"),openExternalToBlank:!1,routeLinks:"a, .go-to",skipRouting:".noscript",scrollTo:[0,0]}),Backbone.on("adjustTitle",this.adjustTitle,this),Layout.__super__.constructor.apply(this,arguments),this.settings.routeLinks&&this.startLinkRouting()}return __extends(Layout,_super),Layout.prototype.el="body",Layout.prototype.keepElement=!0,Layout.prototype.title="",Layout.prototype.listen={"beforeControllerDispose mediator":"scroll"},Layout.prototype.scroll=function(){var position;return position=this.settings.scrollTo,position?window.scrollTo(position[0],position[1]):void 0},Layout.prototype.adjustTitle=function(subtitle){var title;return null==subtitle&&(subtitle=""),title=this.settings.titleTemplate({title:this.title,subtitle:subtitle}),document.title=title,title},Layout.prototype.startLinkRouting=function(){var route;return route=this.settings.routeLinks,route?this.$el.on("click",route,this.openLink):void 0},Layout.prototype.stopLinkRouting=function(){var route;return route=this.settings.routeLinks,route?this.$el.off("click",route):void 0},Layout.prototype.isExternalLink=function(link){var _ref,_ref1;return"_blank"===link.target||"external"===link.rel||"http:"!==(_ref=link.protocol)&&"https:"!==_ref&&"file:"!==_ref||(_ref1=link.hostname)!==location.hostname&&""!==_ref1},Layout.prototype.openLink=function(event){var $el,el,external,href,isAnchor,skipRouting,type;if(!(utils.modifierKeyPressed(event)||(el=event.currentTarget,$el=$(el),isAnchor="A"===el.nodeName,href=$el.attr("href")||$el.data("href")||null,null==href||""===href||"#"===href.charAt(0)||(skipRouting=this.settings.skipRouting,type=typeof skipRouting,"function"===type&&!skipRouting(href,el)||"string"===type&&$el.is(skipRouting))))){if(external=isAnchor&&this.isExternalLink(el))return this.settings.openExternalToBlank&&(event.preventDefault(),window.open(href)),void 0;helpers.redirectTo({url:href}),event.preventDefault()}},Layout.prototype.dispose=function(){var prop,_i,_len,_ref;if(!this.disposed){for(this.stopLinkRouting(),_ref=["title","route"],_i=0,_len=_ref.length;_len>_i;_i++)prop=_ref[_i],delete this[prop];return this.off,Layout.__super__.dispose.apply(this,arguments)}},Layout}(Mildred.View);var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Mildred.CollectionView=function(_super){function CollectionView(){this.renderAllItems=__bind(this.renderAllItems,this),this.toggleFallback=__bind(this.toggleFallback,this),this.itemsReset=__bind(this.itemsReset,this),this.itemRemoved=__bind(this.itemRemoved,this),this.itemAdded=__bind(this.itemAdded,this),this.visibleItems=[],CollectionView.__super__.constructor.apply(this,arguments)}return __extends(CollectionView,_super),CollectionView.prototype.itemView=null,CollectionView.prototype.autoRender=!0,CollectionView.prototype.renderItems=!0,CollectionView.prototype.animationDuration=500,CollectionView.prototype.useCssAnimation=!1,CollectionView.prototype.animationStartClass="animated-item-view",CollectionView.prototype.animationEndClass="animated-item-view-end",CollectionView.prototype.listSelector=null,CollectionView.prototype.$list=null,CollectionView.prototype.fallbackSelector=null,CollectionView.prototype.$fallback=null,CollectionView.prototype.loadingSelector=null,CollectionView.prototype.$loading=null,CollectionView.prototype.itemSelector=void 0,CollectionView.prototype.filterer=null,CollectionView.prototype.filterCallback=function(view,included){return view.$el.stop(!0,!0).toggle(included)},CollectionView.prototype.visibleItems=null,CollectionView.prototype.optionNames=Mildred.View.prototype.optionNames.concat(["renderItems","itemView"]),CollectionView.prototype.initialize=function(options){return null==options&&(options={}),this.addCollectionListeners(),null!=options.filterer?this.filter(options.filterer):void 0},CollectionView.prototype.addCollectionListeners=function(){return this.listenTo(this.collection,"add",this.itemAdded),this.listenTo(this.collection,"remove",this.itemRemoved),this.listenTo(this.collection,"reset sort",this.itemsReset)},CollectionView.prototype.getTemplateData=function(){var templateData;return templateData={length:this.collection.length},"function"==typeof this.collection.isSynced&&(templateData.synced=this.collection.isSynced()),templateData},CollectionView.prototype.getTemplateFunction=function(){},CollectionView.prototype.render=function(){return CollectionView.__super__.render.apply(this,arguments),this.$list=this.listSelector?this.$(this.listSelector):this.$el,this.initFallback(),this.initLoadingIndicator(),this.renderItems?this.renderAllItems():void 0},CollectionView.prototype.itemAdded=function(item,collection,options){return this.insertView(item,this.renderItem(item),options.at)},CollectionView.prototype.itemRemoved=function(item){return this.removeViewForItem(item)},CollectionView.prototype.itemsReset=function(){return this.renderAllItems()},CollectionView.prototype.initFallback=function(){return this.fallbackSelector?(this.$fallback=this.$(this.fallbackSelector),this.on("visibilityChange",this.toggleFallback),this.listenTo(this.collection,"syncStateChange",this.toggleFallback),this.toggleFallback()):void 0},CollectionView.prototype.toggleFallback=function(){var visible;return visible=0===this.visibleItems.length&&("function"==typeof this.collection.isSynced?this.collection.isSynced():!0),this.$fallback.toggle(visible)},CollectionView.prototype.initLoadingIndicator=function(){return this.loadingSelector&&"function"==typeof this.collection.isSyncing?(this.$loading=this.$(this.loadingSelector),this.listenTo(this.collection,"syncStateChange",this.toggleLoadingIndicator),this.toggleLoadingIndicator()):void 0},CollectionView.prototype.toggleLoadingIndicator=function(){var visible;return visible=0===this.collection.length&&this.collection.isSyncing(),this.$loading.toggle(visible)},CollectionView.prototype.getItemViews=function(){var itemViews,name,view,_ref;if(itemViews={},this.subviews.length>0){_ref=this.subviewsByName;for(name in _ref)view=_ref[name],"itemView:"===name.slice(0,9)&&(itemViews[name.slice(9)]=view)}return itemViews},CollectionView.prototype.filter=function(filterer,filterCallback){var included,index,item,view,_i,_len,_ref;if(this.filterer=filterer,filterCallback&&(this.filterCallback=filterCallback),null==filterCallback&&(filterCallback=this.filterCallback),!_.isEmpty(this.getItemViews()))for(_ref=this.collection.models,index=_i=0,_len=_ref.length;_len>_i;index=++_i){if(item=_ref[index],included="function"==typeof filterer?filterer(item,index):!0,view=this.subview("itemView:"+item.cid),!view)throw new Error("CollectionView#filter: "+("no view found for "+item.cid));this.filterCallback(view,included),this.updateVisibleItems(view.model,included,!1)}return this.trigger("visibilityChange",this.visibleItems)},CollectionView.prototype.renderAllItems=function(){var cid,index,item,items,remainingViewsByCid,view,_i,_j,_len,_len1,_ref;for(items=this.collection.models,this.visibleItems=[],remainingViewsByCid={},_i=0,_len=items.length;_len>_i;_i++)item=items[_i],view=this.subview("itemView:"+item.cid),view&&(remainingViewsByCid[item.cid]=view);_ref=this.getItemViews();for(cid in _ref)__hasProp.call(_ref,cid)&&(view=_ref[cid],cid in remainingViewsByCid||this.removeSubview("itemView:"+cid));for(index=_j=0,_len1=items.length;_len1>_j;index=++_j)item=items[index],view=this.subview("itemView:"+item.cid),view?this.insertView(item,view,index,!1):this.insertView(item,this.renderItem(item),index);return 0===items.length?this.trigger("visibilityChange",this.visibleItems):void 0},CollectionView.prototype.renderItem=function(item){var view;return view=this.subview("itemView:"+item.cid),view||(view=this.initItemView(item),this.subview("itemView:"+item.cid,view)),view.render(),view},CollectionView.prototype.initItemView=function(model){if(this.itemView)return new this.itemView({model:model,autoRender:!1});throw new Error("The CollectionView#itemView property must be defined or the initItemView() must be overridden.")},CollectionView.prototype.insertView=function(item,view,position,enableAnimation){var $list,$next,$previous,$viewEl,children,childrenLength,included,insertInMiddle,isEnd,length,method,viewEl,_this=this;return null==enableAnimation&&(enableAnimation=!0),0===this.animationDuration&&(enableAnimation=!1),"number"!=typeof position&&(position=this.collection.indexOf(item)),included="function"==typeof this.filterer?this.filterer(item,position):!0,viewEl=view.el,$viewEl=view.$el,included&&enableAnimation&&(this.useCssAnimation?$viewEl.addClass(this.animationStartClass):$viewEl.css("opacity",0)),this.filterer&&this.filterCallback(view,included),length=this.collection.length,insertInMiddle=position>0&&length>position,isEnd=function(length){return 0===length||position===length},$list=this.$list,insertInMiddle||this.itemSelector?(children=$list.children(this.itemSelector),childrenLength=children.length,children.get(position)!==viewEl&&(isEnd(childrenLength)?$list.append(viewEl):0===position?($next=children.eq(position),$next.before(viewEl)):($previous=children.eq(position-1),$previous.after(viewEl)))):(method=isEnd(length)?"append":"prepend",$list[method](viewEl)),view.trigger("addedToParent"),this.updateVisibleItems(item,included),included&&enableAnimation&&(this.useCssAnimation?setTimeout(function(){return $viewEl.addClass(_this.animationEndClass)},0):$viewEl.animate({opacity:1},this.animationDuration)),view},CollectionView.prototype.removeViewForItem=function(item){return this.updateVisibleItems(item,!1),this.removeSubview("itemView:"+item.cid)},CollectionView.prototype.updateVisibleItems=function(item,includedInFilter,triggerEvent){var includedInVisibleItems,visibilityChanged,visibleItemsIndex;return null==triggerEvent&&(triggerEvent=!0),visibilityChanged=!1,visibleItemsIndex=_.indexOf(this.visibleItems,item),includedInVisibleItems=-1!==visibleItemsIndex,includedInFilter&&!includedInVisibleItems?(this.visibleItems.push(item),visibilityChanged=!0):!includedInFilter&&includedInVisibleItems&&(this.visibleItems.splice(visibleItemsIndex,1),visibilityChanged=!0),visibilityChanged&&triggerEvent&&this.trigger("visibilityChange",this.visibleItems),visibilityChanged},CollectionView.prototype.dispose=function(){var prop,properties,_i,_len;if(!this.disposed){for(properties=["$list","$fallback","$loading","visibleItems"],_i=0,_len=properties.length;_len>_i;_i++)prop=properties[_i],delete this[prop];return CollectionView.__super__.dispose.apply(this,arguments)}},CollectionView}(Mildred.View),Mildred.Application=function(){function Application(options){null==options&&(options={}),this.initialize(options)}return Application.extend=Backbone.Model.extend,Application.prototype.title="",Application.prototype.layout=void 0,Application.prototype.router=void 0,Application.prototype.composer=void 0,Application.prototype.started=!1,Application.prototype.initialize=function(options){if(null==options&&(options={}),this.started)throw new Error("Application#initialize: App was already started");return"function"==typeof options.templateFunction&&(Mildred.templateFunction=options.templateFunction),this.initRouter(options.routes,options),this.initDispatcher(options),this.initLayout(options),this.initComposer(options),this.start()},Application.prototype.initDispatcher=function(options){return this.dispatcher=new Mildred.Dispatcher(options)},Application.prototype.initLayout=function(options){var _ref;return null==options&&(options={}),null==(_ref=options.title)&&(options.title=this.title),this.layout=new Mildred.Layout(options)},Application.prototype.initComposer=function(options){return null==options&&(options={}),this.composer=new Mildred.Composer(options)},Application.prototype.initRouter=function(routes,options){return this.router=new Mildred.Router(options),"function"==typeof routes?routes(this.router.match):void 0},Application.prototype.start=function(){return this.router.startHistory(),this.started=!0,"function"==typeof Object.freeze?Object.freeze(this):void 0},Application.prototype.disposed=!1,Application.prototype.dispose=function(){var prop,properties,_i,_len;if(!this.disposed){for(properties=["dispatcher","layout","router","composer"],_i=0,_len=properties.length;_len>_i;_i++)prop=properties[_i],null!=this[prop]&&(this[prop].dispose(),delete this[prop]);return this.disposed=!0}},Application}();